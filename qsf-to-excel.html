<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-THFRCXB7');</script>
    <!-- End Google Tag Manager -->    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">    
    <title>Free QSF to Excel Converter | Pirai AI | Qualtrics Survey Documentation Tool</title>
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": "Pirai AI",
      "url": "https://piraiai.com",
      "logo": "https://piraiai.com/logo.png"
    }
    </script>    
    
    <link rel="icon" href="https://piraiai.com/logo.png" type="image/png">
	<link rel="apple-touch-icon" href="https://piraiai.com/logo.png">
	<meta name="description" content="Free QSF to Excel converter tool. Transform Qualtrics survey files into comprehensive Excel documentation workbooks. Built by Pirai AI survey automation experts.">
    <!-- Open Graph for social sharing -->
    <meta property="og:title" content="Free QSF to Excel Converter - Pirai AI">
    <meta property="og:description" content="Convert Qualtrics QSF files to comprehensive Excel documentation workbooks. Free tool by Pirai AI.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://piraiai.com/qsf-to-excel">
    <meta property="og:image" content="https://piraiai.com/logo.png">

    <link rel="canonical" href="https://piraiai.com/qsf-to-excel" />
    <!-- Excel Processing Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600;700;800&family=Inter:wght@400;500;700&display=swap" rel="stylesheet"/>	        
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #e5e7eb;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
            min-height: 100vh;
        }

        h1, h2, h3, h4, h5, h6 {
            font-family: 'Space Grotesk', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }         
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* Navigation */
        .nav {
            background: rgba(17, 24, 39, 0.5);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid #374151;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }
        
        .nav-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 0;
        }
        
        .logo {
            display: flex;
            align-items: center;
            color: #ffffff;
            text-decoration: none;
            font-size: 24px;
            font-weight: 700;
            font-family: 'Space Grotesk', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            letter-spacing: 0.01em;             
        }
        
        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            border-radius: 8px;
            margin-right: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }
        
        .nav-links {
            display: flex;
            gap: 32px;
            list-style: none;
        }
        
        .nav-links a {
            color: #9ca3af;
            text-decoration: none;
            transition: color 0.3s;
        }
        
        .nav-links a:hover {
            color: #ffffff;
        }
        
        .nav-cta {
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            color: white;
            padding: 8px 24px;
            border-radius: 24px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .nav-cta:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.3);
        }
        
        /* Hero Section */
        .hero {
            padding: 140px 0 60px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .hero h1 {
            font-size: 48px;
            font-weight: 700;
            margin-bottom: 24px;
            background: linear-gradient(135deg, #60a5fa, #a78bfa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            line-height: 1.4;
        }
        
        .hero-subtitle {
            font-size: 24px;
            color: #d1d5db;
            margin-bottom: 32px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .hero-highlight {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.2), rgba(59, 130, 246, 0.2));
            border: 1px solid rgba(34, 197, 94, 0.3);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 32px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .hero-highlight h3 {
            font-size: 24px;
            color: #22c55e;
            margin-bottom: 8px;
        }
        
        .hero-highlight p {
            font-size: 18px;
            margin-bottom: 8px;
        }
        
        /* Privacy Section */
        .privacy-section {
            margin-top: 32px;
            max-width: 900px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .privacy-badge {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.15), rgba(59, 130, 246, 0.15));
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 16px;
            padding: 24px;
            display: flex;
            align-items: flex-start;
            gap: 20px;
            text-align: left;
        }
        
        .privacy-icon {
            font-size: 2.5rem;
            flex-shrink: 0;
            margin-top: 4px;
        }
        
        .privacy-content h4 {
            font-size: 20px;
            font-weight: 700;
            color: #10b981;
            margin-bottom: 8px;
        }
        
        .privacy-content p {
            font-size: 16px;
            color: #d1d5db;
            margin-bottom: 16px;
            line-height: 1.5;
        }
        
        .privacy-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 8px;
        }
        
        .privacy-features span {
            font-size: 14px;
            color: #a7f3d0;
            font-weight: 500;
        }
        
        /* Tool Section */
        .tool-section {
            padding: 60px 0;
        }
        
        .tool-container {
            background: rgba(31, 41, 55, 0.5);
            backdrop-filter: blur(10px);
            border-radius: 24px;
            padding: 48px;
            border: 1px solid rgba(55, 65, 81, 0.5);
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .file-input-section {
            background: rgba(55, 65, 81, 0.3);
            padding: 32px;
            border-radius: 16px;
            margin-bottom: 32px;
            border: 2px dashed #6b7280;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .file-input-section:hover {
            border-color: #3b82f6;
            background: rgba(59, 130, 246, 0.1);
        }
        
        .file-input-section.active {
            border-color: #22c55e;
            background: rgba(34, 197, 94, 0.1);
        }
        
        .file-input-label {
            display: block;
            text-align: center;
            font-size: 18px;
            color: #d1d5db;
            cursor: pointer;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #22c55e, #3b82f6);
            color: white;
            padding: 16px 32px;
            border-radius: 24px;
            text-decoration: none;
            font-weight: 600;
            font-size: 18px;
            transition: all 0.3s;
            border: none;
            cursor: pointer;
            margin: 10px;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(34, 197, 94, 0.3);
        }
        
        .btn-secondary {
            border: 1px solid #6b7280;
            color: #d1d5db;
            padding: 16px 32px;
            border-radius: 24px;
            text-decoration: none;
            font-weight: 600;
            font-size: 18px;
            transition: all 0.3s;
            background: transparent;
            cursor: pointer;
            margin: 10px;
        }
        
        .btn-secondary:hover {
            border-color: #9ca3af;
            color: #ffffff;
        }
        
        .download-btn {
            background: linear-gradient(135deg, #8b5cf6, #3b82f6);
        }
        
        .download-btn:hover {
            box-shadow: 0 10px 25px rgba(139, 92, 246, 0.3);
        }
        
        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 32px 0;
        }
        
        .stat-card {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(139, 92, 246, 0.2));
            border: 1px solid rgba(59, 130, 246, 0.3);
            padding: 24px;
            border-radius: 12px;
            text-align: center;
            transition: all 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-4px);
            border-color: #3b82f6;
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #60a5fa;
            margin-bottom: 8px;
        }
        
        .stat-label {
            font-size: 1rem;
            color: #d1d5db;
        }
        
        /* Sheets Preview */
        .sheets-preview {
            background: rgba(55, 65, 81, 0.3);
            border-radius: 16px;
            padding: 32px;
            margin: 32px 0;
        }
        
        .sheet-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            margin: 8px 0;
            background: rgba(31, 41, 55, 0.5);
            border-radius: 8px;
            border-left: 4px solid #3b82f6;
            transition: all 0.3s;
        }
        
        .sheet-item:hover {
            transform: translateX(4px);
            border-left-color: #22c55e;
        }
        
        .sheet-name {
            font-weight: 600;
            color: #ffffff;
            font-size: 16px;
        }
        
        .sheet-desc {
            color: #9ca3af;
            font-size: 14px;
            margin-top: 4px;
        }
        
        .progress {
            display: none;
            text-align: center;
            margin: 32px 0;
        }
        
        .loading {
            display: inline-block;
            width: 32px;
            height: 32px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 16px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .sample-data {
            display: none;
            background: rgba(17, 24, 39, 0.8);
            color: #e5e7eb;
            padding: 24px;
            border-radius: 12px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #374151;
        }
        
        /* Thank You Section */
        .thank-you-section {
            padding: 80px 0;
            background: linear-gradient(135deg, rgba(31, 41, 55, 0.8), rgba(17, 24, 39, 0.8));
        }
        
        .thank-you-content {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .thank-you-card {
            background: rgba(31, 41, 55, 0.5);
            backdrop-filter: blur(10px);
            padding: 48px;
            border-radius: 24px;
            border: 1px solid rgba(55, 65, 81, 0.5);
            text-align: center;
        }
        
        .thank-you-icon {
            font-size: 4rem;
            margin-bottom: 24px;
        }
        
        .thank-you-card h2 {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 16px;
            color: #ffffff;
        }
        
        .thank-you-message {
            font-size: 18px;
            color: #d1d5db;
            margin-bottom: 32px;
            line-height: 1.6;
        }
        
        .thank-you-stats {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.2), rgba(59, 130, 246, 0.2));
            border: 1px solid rgba(34, 197, 94, 0.3);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 32px;
        }
        
        .thank-you-cta {
            margin-bottom: 32px;
        }
        
        .cta-text {
            font-size: 16px;
            color: #d1d5db;
            margin-bottom: 24px;
            line-height: 1.6;
        }
        
        .subtle-cta {
            font-size: 14px;
            color: #9ca3af;
            margin-top: 16px;
            font-style: italic;
        }
        
        .social-share {
            border-top: 1px solid #374151;
            padding-top: 32px;
        }
        
        .social-share p {
            color: #9ca3af;
            margin-bottom: 16px;
            font-size: 14px;
        }
        
        .share-buttons {
            display: flex;
            justify-content: center;
            gap: 16px;
        }
        
        .share-btn {
            background: rgba(55, 65, 81, 0.5);
            color: #d1d5db;
            padding: 12px 24px;
            border-radius: 8px;
            text-decoration: none;
            font-size: 14px;
            transition: all 0.3s;
            border: 1px solid #6b7280;
        }
        
        .share-btn:hover {
            background: rgba(75, 85, 99, 0.7);
            color: #ffffff;
            transform: translateY(-2px);
        }
        
        /* Footer */
        .footer {
            background: rgba(17, 24, 39, 0.5);
            backdrop-filter: blur(10px);
            border-top: 1px solid #374151;
            padding: 48px 0;
        }
        
        .footer-content {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr;
            gap: 32px;
        }
        
        .footer-brand {
            display: flex;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .footer-brand span {
            font-size: 24px;
            font-weight: 700;
            color: #ffffff;
        }
        
        .footer-desc {
            color: #9ca3af;
            margin-bottom: 16px;
            max-width: 400px;
        }
        
        .footer-section h3 {
            color: #ffffff;
            font-weight: 600;
            margin-bottom: 16px;
        }
        
        .footer-links {
            list-style: none;
        }
        
        .footer-links li {
            margin-bottom: 8px;
        }
        
        .footer-links a {
            color: #9ca3af;
            text-decoration: none;
            transition: color 0.3s;
        }
        
        .footer-links a:hover {
            color: #ffffff;
        }
        
        .footer-bottom {
            border-top: 1px solid #374151;
            margin-top: 32px;
            padding-top: 32px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 16px;
        }
        
        .footer-bottom .copyright {
            color: #9ca3af;
            font-size: 14px;
        }
        
        /* Floating elements */
        .float-element-1 {
            position: absolute;
            top: 25%;
            left: 25%;
            width: 256px;
            height: 256px;
            background: rgba(59, 130, 246, 0.1);
            border-radius: 50%;
            filter: blur(60px);
            animation: float 6s ease-in-out infinite;
        }
        
        .float-element-2 {
            position: absolute;
            bottom: 25%;
            right: 25%;
            width: 384px;
            height: 384px;
            background: rgba(139, 92, 246, 0.1);
            border-radius: 50%;
            filter: blur(60px);
            animation: float 6s ease-in-out infinite;
            animation-delay: -3s;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }
            
            .hero h1 {
                font-size: 32px;
            }
            
            .hero-subtitle {
                font-size: 18px;
            }
            
            .tool-container {
                padding: 24px;
            }
            
            .thank-you-card {
                padding: 32px 24px;
            }
            
            .thank-you-card h2 {
                font-size: 28px;
            }
            
            .footer-content {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .share-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .privacy-badge {
                flex-direction: column;
                text-align: center;
                padding: 20px;
            }
            
            .privacy-features {
                grid-template-columns: 1fr;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-THFRCXB7"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    
    <!-- Navigation -->
    <nav class="nav">
        <div class="container">
            <div class="nav-content">
                <a href="/" class="logo">
                    <img src="https://piraiai.com/logo.png" alt="Pirai AI Logo" width="35" height="35"/>&nbsp;
                    Pirai AI
                </a>
                <ul class="nav-links">
                    <li><a href="/#process">Process</a></li>                    
                    <li><a href="/#efficiency">Efficiency</a></li>    
                    <li><a href="/#testimonials">Evidence</a></li>      
                    <li><a href="/#platforms">Platforms</a></li>            
                    <li><a href="/#pricing">Pricing</a></li> 
                </ul>
                <a href="/#demo" class="nav-cta">Get Demo</a>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero">
        <div class="container">
            <h1>Free QSF to Excel Converter</h1>
            <p class="hero-subtitle">
                Transform your Qualtrics survey files into comprehensive Excel documentation workbooks. Professional survey analysis made simple.
            </p>
            
            <div class="hero-highlight">
                <h3>üéÅ Completely Free Tool</h3>
                <p>Convert QSF files to detailed Excel reports with survey metadata, questions, logic, and integrations</p>
            </div>
            
            <!-- Privacy & Security Badge -->
            <div class="privacy-section">
                <div class="privacy-badge">
                    <div class="privacy-icon">üîí</div>
                    <div class="privacy-content">
                        <h4>100% Private & GDPR Compliant</h4>
                        <p>Your survey files are processed entirely in your browser. No uploads, no storage, no data retention. We literally cannot access your files.</p>
                        <div class="privacy-features">
                            <span>‚úì Client-side processing only</span>
                            <span>‚úì Zero server data storage</span>
                            <span>‚úì GDPR & HIPAA friendly</span>
                            <span>‚úì Enterprise security standards</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Floating Elements -->
        <div class="float-element-1"></div>
        <div class="float-element-2"></div>
    </section>

    <!-- Tool Section -->
    <section class="tool-section">
        <div class="container">
            <div class="tool-container">
                <div class="file-input-section" id="fileInputSection">
                    <label for="qsfFile" class="file-input-label">
                        üìÅ Select your QSF file to convert into Excel documentation
                    </label>
                    <input type="file" id="qsfFile" accept=".qsf,.json" style="display: none;">
                </div>

                <div style="text-align: center;">
                    <button class="btn-primary" onclick="processQSF()">üîÑ Generate Excel Workbook</button>
                    <button class="btn-secondary" onclick="loadSampleData()">üìã View Sample Structure</button>
                    <button class="btn-primary download-btn" id="downloadBtn" onclick="downloadExcel()" style="display: none;">üì• Download Excel File</button>
                </div>

                <div class="progress" id="progress">
                    <div class="loading"></div>
                    <p style="color: #d1d5db;">Processing QSF data and generating Excel workbook...</p>
                </div>

                <div id="stats" style="display: none;">
                    <h3 style="color: #ffffff; text-align: center; margin-bottom: 24px;">üìà Analysis Results</h3>
                    <div class="stats-grid" id="statsGrid"></div>
                </div>

                <div id="sheetsPreview" style="display: none;">
                    <h3 style="color: #ffffff; margin-bottom: 24px;">üìã Excel Sheets Generated</h3>
                    <div class="sheets-preview" id="sheetsList"></div>
                </div>

                <div class="sample-data" id="sampleData"></div>
            </div>
        </div>
    </section>

    <!-- Thank You Section -->
    <section class="thank-you-section" id="thankYouSection" style="display: none;">
        <div class="container">
            <div class="thank-you-content">
                <div class="thank-you-card">
                    <div class="thank-you-icon">üéâ</div>
                    <h2>Download Complete!</h2>
                    <p class="thank-you-message">
                        Your comprehensive Excel analysis has been downloaded successfully. We hope this tool saves you valuable time in documenting your survey structure.
                    </p>
                    
                    <div class="thank-you-stats" id="thankYouStats">
                        <!-- Dynamic stats will be inserted here -->
                    </div>
                    
                    <div class="thank-you-cta">
                        <p class="cta-text">
                            <strong>Enjoyed the free tool?</strong> If you're spending hours manually programming surveys, 
                            discover how we help research teams automate the entire process.
                        </p>
                        <a href="/#features" class="btn-primary">Learn About Survey Automation</a>
                        <p class="subtle-cta">
                            Save 8+ hours per survey ‚Ä¢ $121,740+ annually ‚Ä¢ First conversion free
                        </p>
                    </div>
                    
                    <div class="social-share">
                        <p>Help others in the Qualtrics community:</p>
                        <div class="share-buttons">
                            <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://piraiai.com/qsf-to-excel.html" target="_blank" class="share-btn">
                                üì§ Share Tool
                            </a>
                        </div>
                        <p style="margin-top: 24px; font-size: 12px; color: #6b7280; font-style: italic;">
                            üîí Your survey data was processed entirely in your browser - we never saw your files
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
	<footer class="footer">
		<div class="container">
			<div class="footer-content">
				<div>
					<div class="footer-brand">
						<img src="https://piraiai.com/logo.png" alt="Pirai AI Logo" width="35" height="35"/>&nbsp;
						<span>Pirai AI</span>
					</div>
					<p class="footer-desc">
						Universal platform automation transforming documents to 20+ platforms across research, education, healthcare, and enterprise. Deploy globally in 50+ languages with enterprise-grade reliability.
					</p>
					<div style="margin-top: 16px;">
						<p style="color: #9ca3af; font-size: 14px; margin-bottom: 8px;">
							<strong style="color: #60a5fa;">üìß Contact:</strong> admin@piraiai.com
						</p>
						<p style="color: #9ca3af; font-size: 14px;">
							<strong style="color: #22c55e;">üöÄ Universal Access:</strong> Join our exclusive beta program
						</p>
					</div>
				</div>
				
				<div class="footer-section">
					<h3>Product</h3>
					<ul class="footer-links">
						<li><a href="/">Home</a></li>
						<li><a href="/#process">How It Works</a></li>
						<li><a href="/#features">Features</a></li>
						<li><a href="/#pricing">Pricing</a></li>
                        <li><a href="/faq">FAQ</a></li>
                        <li><a href="/blog">Blog</a></li>
                        <li><a href="/gethelp">Get Help</a></li>                        
						<li><a href="/#demo">Early Access</a></li>
					</ul>
				</div>
				
				<div class="footer-section">
					<h3>Free Tools</h3>
					<ul class="footer-links">
                        <li><a href="https://qstar.piraiai.com" target="_blank">QStar (Beta)</a></li>
                        <li><a href="https://chromewebstore.google.com/detail/qualtrics-api-toolkit-by/lloepmlcmkeohopokcedejdelohoilip" target="_blank">Qualtrics API Toolkit</a></li>
                        <li><a href="/qsf-to-excel">QSF to Excel WorkBook</a></li>
						<li><a href="/textiq-to-excel">Text IQ JSON to Excel Book</a></li>
                        <li><a href="/embedded-data-generator">Embedded Data Generator</a></li>
						<li><a href="/pirai-csv-comparator">CSV Comparator</a></li>
                        <li><a href="/qualtrics-toolkit" style="color: #3b82f6;">Command Center</a></li>                         
					</ul>
				</div>
				
				<div class="footer-section">
					<h3>Company</h3>
					<ul class="footer-links">
						<li><a href="/about">About Us</a></li>						
						<li><a href="/#demo">Contact Us</a></li>
						<li><a href="/privacy">Privacy Policy</a></li>
						<li><a href="/terms">Terms of Service</a></li>
                        <li><a href="/security">Security Overview</a></li>
						<li><a href="https://www.linkedin.com/company/pirai-ai/" target="_blank">LinkedIn</a></li>
					</ul>
				</div>
			</div>
			
			<div class="footer-bottom">
				<div class="copyright">
					¬© <script>document.write(new Date().getFullYear())</script> Pirai AI. All rights reserved. | Built with enterprise-grade security and privacy protection.
				</div>
				<div style="display: flex; gap: 16px; align-items: center;">
					<a href="https://www.linkedin.com/company/pirai-ai/" target="_blank" style="color: #9ca3af; transition: color 0.3s;">
						<svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
							<path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
						</svg>
					</a>
                    <a href="https://www.youtube.com/@PiraiAI" target="_blank" style="color: #9ca3af; transition: color 0.3s;">
                        <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M23.498 6.186a2.87 2.87 0 0 0-2.02-2.034C19.65 3.74 12 3.74 12 3.74s-7.65 0-9.478.412A2.87 2.87 0 0 0 .502 6.186C.088 8.02.088 12 .088 12s0 3.98.414 5.814a2.87 2.87 0 0 0 2.02 2.034C4.35 20.26 12 20.26 12 20.26s7.65 0 9.478-.412a2.87 2.87 0 0 0 2.02-2.034C23.912 15.98 23.912 12 23.912 12s0-3.98-.414-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
                        </svg>
                    </a>                        
					<span style="color: #6b7280; font-size: 12px;">Follow our journey</span>
				</div>
			</div>
		</div>
	</footer>

    <script>
        let qsfData = null;
        let excelBuffer = null;
        window.currentSurveyName = null;

        // File input handling
        document.getElementById('qsfFile').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        qsfData = JSON.parse(e.target.result);
                        const surveyName = qsfData.SurveyEntry?.SurveyName || 'Unknown Survey';
                        const section = document.getElementById('fileInputSection');
                        section.querySelector('.file-input-label').textContent = `‚úÖ Loaded: ${file.name} (${surveyName})`;
                        section.classList.add('active');
                        console.log(`QSF loaded - Survey: "${surveyName}"`);
                        window.currentSurveyName = surveyName;
                        
                        // Track file upload
                        if (typeof dataLayer !== 'undefined') {
                            dataLayer.push({
                                'event': 'qsf_file_uploaded',
                                'file_name': file.name,
                                'survey_name': surveyName
                            });
                        }
                    } catch (err) {
                        alert('Error parsing QSF file: ' + err.message);
                    }
                };
                reader.readAsText(file);
            }
        });

        function loadSampleData() {
            const sampleStructure = {
                surveyMetadata: "Survey ID, Name, Owner, Brand, Status, Dates",
                questions: "Question analysis with logic, validation, and JavaScript",
                apiIntegrations: "Web service calls for external integrations",
                embeddedData: "Variables for data flow management",
                surveyBlocks: "Blocks organizing the survey structure",
                branchLogic: "Conditional flow elements and routing",
                displayLogic: "Dynamic question showing/hiding rules"
            };

            document.getElementById('sampleData').style.display = 'block';
            document.getElementById('sampleData').innerHTML = `
                <h4 style="color: #60a5fa; margin-bottom: 16px;">üìã QSF Structure Analysis Preview</h4>
                <pre>${JSON.stringify(sampleStructure, null, 2)}</pre>
                <p style="margin-top: 16px;"><strong>Common Features Analyzed:</strong></p>
                <ul style="margin: 16px 0; padding-left: 20px;">
                    <li>üîó External data source integrations</li>
                    <li>üë• Directory and contact management</li>
                    <li>üìß Distribution system configurations</li>
                    <li>üîÑ Complex branching and routing logic</li>
                    <li>üìä Progress tracking and data flow</li>
                    <li>‚öôÔ∏è Custom JavaScript functionality</li>
                </ul>
            `;
            
            // Track sample data view
            if (typeof dataLayer !== 'undefined') {
                dataLayer.push({
                    'event': 'sample_data_viewed',
                    'source': 'qsf_tool_page'
                });
            }
        }

        async function processQSF() {
            if (!qsfData) {
                alert('Please select a QSF file to analyze.');
                return;
            }

            const surveyName = qsfData.SurveyEntry?.SurveyName || 'Unknown';
            console.log(`Processing survey: "${surveyName}"`);

            document.getElementById('progress').style.display = 'block';
            
            // Track processing start
            if (typeof dataLayer !== 'undefined') {
                dataLayer.push({
                    'event': 'qsf_processing_started',
                    'survey_name': surveyName
                });
            }
            
            setTimeout(() => {
                generateExcelWorkbook();
            }, 500);
        }

        function generateExcelWorkbook() {
            try {
                // Extract all components
                const surveyMetadata = qsfData.SurveyEntry;
                const questions = qsfData.SurveyElements.filter(e => e.Element === 'SQ').map(e => e.Payload);
                const flowElement = qsfData.SurveyElements.find(e => e.Element === 'FL');
                const blockElement = qsfData.SurveyElements.find(e => e.Element === 'BL');
                const surveyFlow = flowElement?.Payload?.Flow || [];

                const webServices = [];
                const embeddedDataSets = [];
                const branches = [];
                const blocks = [];
                
                // Extract blocks - Handle both array and object formats
                if (blockElement?.Payload) {
                    // Convert to array if it's an object (handles both formats)
                    const blocksData = Array.isArray(blockElement.Payload) 
                        ? blockElement.Payload 
                        : Object.values(blockElement.Payload);
                    
                    blocksData.forEach(block => {
                        blocks.push([
                            block.ID,
                            block.Type,
                            block.Description || "",
                            block.SubType || "",
                            block.BlockElements?.length || 0,
                            block.BlockElements?.filter(el => el.Type === 'Question').map(el => el.QuestionID).join(', ') || ""
                        ]);
                    });
                }

                // Extract flow elements recursively
                function extractFlowElements(flow, context = "") {
                    flow.forEach(item => {
                        if (item.Type === 'WebService') {
                            webServices.push([
                                webServices.length + 1,
                                item.FlowID,
                                item.Method,
                                (item.URL || "").substring(0, 120),
                                item.ContentType,
                                item.Headers?.length || 0,
                                Object.keys(item.Body || {}).length,
                                item.ResponseMap?.length || 0,
                                context
                            ]);
                        }
                        
                        if (item.Type === 'EmbeddedData' && item.EmbeddedData) {
                            item.EmbeddedData.forEach(ed => {
                                embeddedDataSets.push([
                                    item.FlowID,
                                    ed.Field,
                                    ed.Description || "",
                                    ed.Type,
                                    ed.VariableType,
                                    (ed.Value || "").toString().substring(0, 100),
                                    ed.Type === 'Recipient' ? 'Recipient' : 'Custom'
                                ]);
                            });
                        }
                        
                        if (item.Type === 'Branch') {
                            branches.push([
                                item.FlowID,
                                item.Description || "",
                                item.BranchLogic?.Type || "",
                                item.Flow?.length || 0,
                                context
                            ]);
                        }
                        
                        if (item.Flow) {
                            extractFlowElements(item.Flow, item.Description || item.Type);
                        }
                    });
                }

                extractFlowElements(surveyFlow);

                // ============================================================================
                // PHASE 1 & PHASE 2: EXTRACT NEW DATA
                // ============================================================================

                // PHASE 1: Display Logic Extraction
                const displayLogicData = [];

                questions.forEach(q => {
                    if (q.DisplayLogic) {
                        try {
                            function extractLogicConditions(logic, conditions = []) {
                                if (!logic) return conditions;
                                
                                if (logic.Type === 'BooleanExpression' && logic['0']) {
                                    const mainLogic = logic['0'];
                                    
                                    Object.keys(mainLogic).forEach(key => {
                                        if (key === 'Type') return;
                                        
                                        const condition = mainLogic[key];
                                        if (condition.Type === 'Expression') {
                                            conditions.push({
                                                logicType: condition.Type === 'If' ? 'If' : (condition.Conjuction || 'And'),
                                                sourceQuestionID: condition.QuestionID || condition.LeftOperand || 'N/A',
                                                logicCategory: condition.LogicType || 'Unknown',
                                                operator: condition.Operator || 'N/A',
                                                leftOperand: condition.LeftOperand || 'N/A',
                                                rightOperand: condition.RightOperand || 'N/A',
                                                description: condition.Description ? 
                                                    condition.Description.replace(/<[^>]*>/g, '').replace(/\s+/g, ' ').trim() :
                                                    `${condition.LogicType || ''} ${condition.Operator || ''}`
                                            });
                                        }
                                    });
                                }
                                
                                return conditions;
                            }
                            
                            const conditions = extractLogicConditions(q.DisplayLogic);
                            
                            let logicString = '';
                            if (conditions.length > 0) {
                                logicString = conditions.map((cond, idx) => {
                                    const conjunction = idx === 0 ? 'IF' : (cond.logicType || 'AND');
                                    return `${conjunction}: ${cond.logicCategory} [${cond.sourceQuestionID}] ${cond.operator} ${cond.rightOperand}`;
                                }).join(' | ');
                            } else {
                                logicString = JSON.stringify(q.DisplayLogic).substring(0, 500);
                            }
                            
                            const questionText = q.QuestionText ? 
                                q.QuestionText.replace(/<[^>]*>/g, '').replace(/\s+/g, ' ').trim() : '';
                            
                            displayLogicData.push([
                                q.QuestionID,
                                questionText.length > 100 ? questionText.substring(0, 100) + "..." : questionText,
                                "Yes",
                                conditions.length,
                                logicString.length > 500 ? logicString.substring(0, 500) + "..." : logicString
                            ]);
                        } catch (error) {
                            console.warn(`Error extracting display logic for ${q.QuestionID}:`, error);
                        }
                    }
                });

                // PHASE 1: Email Triggers Extraction
                const emailTriggersData = [];
                const triggerElements = qsfData.SurveyElements.filter(e => e.Element === 'TR');

                triggerElements.forEach(triggerElement => {
                    try {
                        const trigger = triggerElement.Payload;
                        
                        let logicSummary = 'No conditions';
                        let conditionCount = 0;
                        
                        if (trigger.Logic) {
                            try {
                                const logic = trigger.Logic;
                                const conditions = [];
                                
                                if (logic['0']) {
                                    Object.keys(logic['0']).forEach(key => {
                                        if (key === 'Type') return;
                                        
                                        const condition = logic['0'][key];
                                        if (condition.Type === 'Expression') {
                                            const desc = condition.Description ? 
                                                condition.Description.replace(/<[^>]*>/g, '').replace(/\s+/g, ' ').trim() :
                                                `${condition.LogicType || ''} ${condition.LeftOperand || ''} ${condition.Operator || ''} ${condition.RightOperand || ''}`;
                                            conditions.push(desc);
                                        }
                                    });
                                }
                                
                                conditionCount = conditions.length;
                                logicSummary = conditions.length > 0 ? conditions.join(' AND ') : 'No conditions';
                                
                                if (logicSummary.length > 300) {
                                    logicSummary = logicSummary.substring(0, 300) + "...";
                                }
                            } catch (error) {
                                logicSummary = 'Complex logic - see QSF file';
                            }
                        }
                        
                        emailTriggersData.push([
                            triggerElement.PrimaryAttribute || 'N/A',
                            trigger.Name || 'Unnamed Trigger',
                            trigger.TriggerAction || 'N/A',
                            trigger.EventType || trigger.Type || 'N/A',
                            trigger.ToEmail || 'N/A',
                            trigger.FromName || 'N/A',
                            trigger.FromEmail || 'N/A',
                            trigger.Subject || 'N/A',
                            trigger.Message || 'N/A',
                            trigger.IncludeReport ? 'Yes' : 'No',
                            trigger.UseFullText ? 'Yes' : 'No',
                            conditionCount,
                            logicSummary
                        ]);
                    } catch (error) {
                        console.warn('Error extracting trigger:', error);
                    }
                });

                // PHASE 2: Validation Rules Extraction
                const validationRulesData = [];

                questions.forEach(q => {
                    try {
                        const validation = q.Validation?.Settings || {};
                        const questionText = q.QuestionText ? 
                            q.QuestionText.replace(/<[^>]*>/g, '').replace(/\s+/g, ' ').trim() : '';
                        
                        validationRulesData.push([
                            q.QuestionID,
                            questionText.length > 100 ? questionText.substring(0, 100) + "..." : questionText,
                            q.QuestionType || 'N/A',
                            validation.ForceResponse || 'OFF',
                            validation.ForceResponseType || 'OFF',
                            validation.Type || 'None',
                            validation.ContentType || 'N/A',
                            validation.MinValue || validation.MinLength || 'N/A',
                            validation.MaxValue || validation.MaxLength || 'N/A',
                            validation.CustomValidationMessage || 'N/A',
                            validation.ValidDateType || 'N/A',
                            validation.ValidPhoneType || 'N/A',
                            validation.ValidZipType || 'N/A'
                        ]);
                    } catch (error) {
                        console.warn(`Error extracting validation for ${q.QuestionID}:`, error);
                    }
                });

                // PHASE 2: Recode Values Extraction
                const recodeValuesData = [];

                questions.forEach(q => {
                    if (q.RecodeValues) {
                        try {
                            const questionText = q.QuestionText ? 
                                q.QuestionText.replace(/<[^>]*>/g, '').replace(/\s+/g, ' ').trim() : '';
                            
                            Object.entries(q.RecodeValues).forEach(([choiceId, recodeValue]) => {
                                const choiceText = q.Choices && q.Choices[choiceId] ? 
                                    (q.Choices[choiceId].Display || choiceId) : choiceId;
                                
                                let purpose = 'Data transformation';
                                if (recodeValue === '1' || recodeValue === '0') {
                                    purpose = 'Binary: 1=Yes, 0=No';
                                } else if (!isNaN(recodeValue)) {
                                    purpose = 'Numeric scoring';
                                }
                                
                                recodeValuesData.push([
                                    q.QuestionID,
                                    questionText.length > 100 ? questionText.substring(0, 100) + "..." : questionText,
                                    q.QuestionType || 'N/A',
                                    choiceId,
                                    choiceText,
                                    recodeValue,
                                    purpose
                                ]);
                            });
                        } catch (error) {
                            console.warn(`Error extracting recode values for ${q.QuestionID}:`, error);
                        }
                    }
                });
                // PHASE 3: JavaScript Extraction
                const javascriptData = [];

                questions.forEach(q => {
                    // Only process questions that have JavaScript
                    if (q.QuestionJS && q.QuestionJS !== false) {
                        try {
                            const questionText = q.QuestionText ? 
                                q.QuestionText.replace(/<[^>]*>/g, '').replace(/\s+/g, ' ').trim() : '';
                            
                            const jsCode = typeof q.QuestionJS === 'string' ? q.QuestionJS : String(q.QuestionJS);
                            
                            // Detect event types (case-insensitive)
                            const hasOnLoad = jsCode.toLowerCase().includes('addonload');
                            const hasOnReady = jsCode.toLowerCase().includes('addonready');
                            const hasOnUnload = jsCode.toLowerCase().includes('addonunload');
                            
                            javascriptData.push([
                                q.QuestionID,
                                questionText.length > 100 ? questionText.substring(0, 100) + "..." : questionText,
                                q.QuestionType || 'N/A',
                                'Yes',
                                jsCode.length,
                                hasOnLoad ? 'Yes' : 'No',
                                hasOnReady ? 'Yes' : 'No',
                                hasOnUnload ? 'Yes' : 'No',
                                jsCode  // Full code, no truncation
                            ]);
                        } catch (error) {
                            console.warn(`Error extracting JavaScript for ${q.QuestionID}:`, error);
                        }
                    }
                });

                console.log(`Extracted JavaScript for ${javascriptData.length} questions`);
                // ============================================================================
                // END OF EXTRACTION CODE
                // ============================================================================

                // Create Excel workbook
                const workbook = XLSX.utils.book_new();

                // Sheet 1: Survey Overview
                const overviewData = [
                    ["Pirai AI - QSF Analysis Report", ""],
                    ["Property", "Value"],
                    ["Survey ID", surveyMetadata.SurveyID],
                    ["Survey Name", surveyMetadata.SurveyName],
                    ["Owner ID", surveyMetadata.SurveyOwnerID],
                    ["Brand ID", surveyMetadata.SurveyBrandID],
                    ["Status", surveyMetadata.SurveyStatus],
                    ["Created Date", surveyMetadata.SurveyCreationDate],
                    ["Last Modified", surveyMetadata.LastModified],
                    ["Language", surveyMetadata.SurveyLanguage],
                    [""],
                    ["Architecture Statistics", ""],
                    ["Total Questions", questions.length],
                    ["API Integrations", webServices.length],
                    ["Embedded Data Variables", embeddedDataSets.length],
                    ["Survey Blocks", blocks.length],
                    ["Branch Logic Elements", branches.length],
                    [""],
                    ["Generated on", new Date().toISOString()],
                    ["Generated by", "Pirai AI QSF Converter"]
                ];

                XLSX.utils.book_append_sheet(workbook, XLSX.utils.aoa_to_sheet(overviewData), "Survey Overview");

                // Sheet 2: Questions Detail
                const questionData = [
                    ["Question ID", "Export Tag", "Question Text", "Type", "Selector", "Sub Selector", "Validation", "Display Logic", "JavaScript", "Has Choices", "Search Source"]
                ];

                questions.forEach(q => {
                    const questionText = q.QuestionText ? 
                        q.QuestionText.replace(/<[^>]*>/g, '').replace(/\s+/g, ' ').trim() : '';
                    
                    questionData.push([
                        q.QuestionID,
                        q.DataExportTag,
                        questionText.length > 200 ? questionText.substring(0, 200) + "..." : questionText,
                        q.QuestionType,
                        q.Selector,
                        q.SubSelector || "",
                        q.Validation?.Settings?.ForceResponse || "None",
                        q.DisplayLogic ? "Yes" : "No",
                        q.QuestionJS ? "Yes" : "No",
                        q.Choices ? Object.keys(q.Choices).length + " choices" : "No",
                        q.SearchSource?.Type || ""
                    ]);
                });

                XLSX.utils.book_append_sheet(workbook, XLSX.utils.aoa_to_sheet(questionData), "Questions Detail");

                // Sheet 3: API Integrations
                const apiData = [
                    ["Step", "Flow ID", "Method", "URL/Path", "Content Type", "Headers", "Body Parameters", "Response Mappings", "Context"],
                    ...webServices
                ];

                XLSX.utils.book_append_sheet(workbook, XLSX.utils.aoa_to_sheet(apiData), "API Integrations");

                // Sheet 4: Embedded Data
                const embeddedData = [
                    ["Flow ID", "Field Name", "Description", "Type", "Variable Type", "Default Value", "Data Source"],
                    ...embeddedDataSets
                ];

                XLSX.utils.book_append_sheet(workbook, XLSX.utils.aoa_to_sheet(embeddedData), "Embedded Data");

                // Sheet 5: Survey Blocks
                const blockData = [
                    ["Block ID", "Type", "Description", "Sub Type", "Element Count", "Questions Included"],
                    ...blocks
                ];

                XLSX.utils.book_append_sheet(workbook, XLSX.utils.aoa_to_sheet(blockData), "Survey Blocks");

                // Sheet 6: Branch Logic
                const branchData = [
                    ["Flow ID", "Description", "Logic Type", "Sub Elements", "Context"],
                    ...branches
                ];

                XLSX.utils.book_append_sheet(workbook, XLSX.utils.aoa_to_sheet(branchData), "Branch Logic");

                // Sheet 7: Question Choices
                const choiceData = [["Question ID", "Choice ID", "Choice Text", "Selected by Default"]];

                questions.forEach(q => {
                    if (q.Choices) {
                        Object.entries(q.Choices).forEach(([choiceId, choice]) => {
                            choiceData.push([
                                q.QuestionID,
                                choiceId,
                                choice.Display || "",
                                q.DefaultChoices && q.DefaultChoices[choiceId] ? "Yes" : "No"
                            ]);
                        });
                    }
                });

                XLSX.utils.book_append_sheet(workbook, XLSX.utils.aoa_to_sheet(choiceData), "Question Choices");

                // Sheet 8: Flow Summary
                const flowSummary = [
                    ["Component Type", "Count", "Description", "Purpose"],
                    ["Web Service Calls", webServices.length, "API integrations for external data", "Data lookup, directory management, link generation"],
                    ["Embedded Data Variables", embeddedDataSets.length, "Variables for data management", "System configuration"],
                    ["Branch Logic Elements", branches.length, "Conditional flow controls", "Dynamic routing and question visibility"],
                    ["Survey Blocks", blocks.length, "Question organization blocks", "User interface organization and flow control"],
                    ["Total Questions", questions.length, "Survey questions and display blocks", ""],
                    ["Display Logic Rules", displayLogicData.length, "Questions with conditional display", "Show/hide questions based on responses"],
                    ["Email Triggers", emailTriggersData.length, "Automated email notifications", "Workflow automation and alerts"],
                    ["Validation Rules", validationRulesData.filter(v => v[5] !== 'None').length, "Questions with validation rules", "Data quality and required fields"],
                    ["Recode Mappings", recodeValuesData.length, "Choice value transformations", "Data recoding for analysis"],
                    ["Questions with JavaScript", javascriptData.length, "Custom JavaScript code", "Advanced functionality and customization"]
                ];

                XLSX.utils.book_append_sheet(workbook, XLSX.utils.aoa_to_sheet(flowSummary), "Flow Summary");

                // Sheet 9: Display Logic
                const displayLogicSheet = [
                    ["Question ID", "Question Text", "Has Display Logic", "Condition Count", "Display Logic Conditions"],
                    ...displayLogicData
                ];
                XLSX.utils.book_append_sheet(workbook, XLSX.utils.aoa_to_sheet(displayLogicSheet), "Display Logic");

                // Sheet 10: Email Triggers
                const emailTriggersSheet = [
                    ["Trigger ID", "Trigger Name", "Action Type", "Event Type", "To Email", "From Name", "From Email", "Subject", "Message", "Include Report", "Use Full Text", "Condition Count", "Logic Summary"],
                    ...emailTriggersData
                ];
                XLSX.utils.book_append_sheet(workbook, XLSX.utils.aoa_to_sheet(emailTriggersSheet), "Email Triggers");

                // Sheet 11: Validation Rules
                const validationRulesSheet = [
                    ["Question ID", "Question Text", "Question Type", "Force Response", "Force Response Type", "Validation Type", "Content Type", "Min Value/Length", "Max Value/Length", "Custom Message", "Date Type", "Phone Type", "Zip Type"],
                    ...validationRulesData
                ];
                XLSX.utils.book_append_sheet(workbook, XLSX.utils.aoa_to_sheet(validationRulesSheet), "Validation Rules");

                // Sheet 12: Recode Values
                const recodeValuesSheet = [
                    ["Question ID", "Question Text", "Question Type", "Choice ID", "Choice Text", "Recoded Value", "Purpose"],
                    ...recodeValuesData
                ];
                XLSX.utils.book_append_sheet(workbook, XLSX.utils.aoa_to_sheet(recodeValuesSheet), "Recode Values");

                // Sheet 13: JavaScript Code
                const javascriptSheet = [
                    ["Question ID", "Question Text", "Question Type", "Has JavaScript", "Code Length (chars)", "Has OnLoad", "Has OnReady", "Has OnUnload", "JavaScript Code"],
                    ...javascriptData
                ];
                XLSX.utils.book_append_sheet(workbook, XLSX.utils.aoa_to_sheet(javascriptSheet), "JavaScript Code");

                // Generate Excel file
                excelBuffer = XLSX.write(workbook, { bookType: 'xlsx', type: 'array' });

                // Update UI
                document.getElementById('progress').style.display = 'none';
                showResults({
                    questions: questions.length,
                    apis: webServices.length,
                    variables: embeddedDataSets.length,
                    blocks: blocks.length,
                    branches: branches.length,
                    displayLogic: displayLogicData.length,
                    emailTriggers: emailTriggersData.length,
                    validationRules: validationRulesData.filter(v => v[5] !== 'None').length,
                    recodeMappings: recodeValuesData.length,
                    javascript: javascriptData.length,
                    sheets: 13,
                    fileSize: Math.round(excelBuffer.byteLength / 1024)
                });

                // Track successful processing
                if (typeof dataLayer !== 'undefined') {
                    dataLayer.push({
                        'event': 'qsf_processing_completed',
                        'survey_name': window.currentSurveyName,
                        'questions_count': questions.length,
                        'file_size_kb': Math.round(excelBuffer.byteLength / 1024)
                    });
                }

            } catch (error) {
                document.getElementById('progress').style.display = 'none';
                alert('Error generating Excel: ' + error.message);
                console.error(error);
                
                // Track error
                if (typeof dataLayer !== 'undefined') {
                    dataLayer.push({
                        'event': 'qsf_processing_error',
                        'error_message': error.message
                    });
                }
            }
        }

        function showResults(stats) {
            // Show stats
            document.getElementById('stats').style.display = 'block';
            const statsGrid = document.getElementById('statsGrid');
            statsGrid.innerHTML = `
            <div class="stat-card">
                    <div class="stat-number">${stats.questions}</div>
                    <div class="stat-label">Questions</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.apis}</div>
                    <div class="stat-label">APIs</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.variables}</div>
                    <div class="stat-label">Variables</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.blocks}</div>
                    <div class="stat-label">Blocks</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.branches}</div>
                    <div class="stat-label">Branches</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.displayLogic}</div>
                    <div class="stat-label">Display Logic</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.emailTriggers}</div>
                    <div class="stat-label">Email Triggers</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.validationRules}</div>
                    <div class="stat-label">Validation Rules</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.recodeMappings}</div>
                    <div class="stat-label">Recode Mappings</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.fileSize}KB</div>
                    <div class="stat-label">File Size</div>
                </div>
            `;

            // Show sheets preview
            document.getElementById('sheetsPreview').style.display = 'block';
            const sheetsList = document.getElementById('sheetsList');
            const sheets = [
                { name: "Survey Overview", desc: "Metadata, statistics, and summary information" },
                { name: "Questions Detail", desc: "Complete question analysis with types and logic" },
                { name: "API Integrations", desc: "Web service calls and external integrations" },
                { name: "Embedded Data", desc: "Variables and data flow management" },
                { name: "Survey Blocks", desc: "Question organization and block structure" },
                { name: "Branch Logic", desc: "Conditional flow controls and routing" },
                { name: "Question Choices", desc: "Multiple choice options and defaults" },
                { name: "Flow Summary", desc: "Architecture overview and component counts" },
                { name: "Display Logic", desc: "Conditional display rules and logic conditions" },
                { name: "Email Triggers", desc: "Automated email notifications and workflows" },
                { name: "Validation Rules", desc: "Field validation and requirement settings" },
                { name: "Recode Values", desc: "Answer choice recoding for data analysis" },
                { name: "JavaScript Code", desc: "Custom JavaScript code and event handlers" }
            ];

            sheetsList.innerHTML = sheets.map(sheet => `
                <div class="sheet-item">
                    <div>
                        <div class="sheet-name">${sheet.name}</div>
                        <div class="sheet-desc">${sheet.desc}</div>
                    </div>
                    <div style="font-size: 20px;">üìä</div>
                </div>
            `).join('');

            // Show download button
            document.getElementById('downloadBtn').style.display = 'inline-block';
        }

        function downloadExcel() {
            if (!excelBuffer) {
                alert('No Excel file generated yet!');
                return;
            }

            const surveyName = window.currentSurveyName || 'Qualtrics_Survey';
            const timestamp = new Date().toISOString().slice(0, 10);
            const filename = `${surveyName}_Analysis_${timestamp}.xlsx`;

            console.log(`Downloading file: ${filename}`);

            const blob = new Blob([excelBuffer], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            console.log(`Successfully downloaded: ${filename}`);
            
            // Track download
            if (typeof dataLayer !== 'undefined') {
                dataLayer.push({
                    'event': 'excel_download_completed',
                    'file_name': filename,
                    'survey_name': surveyName
                });
            }
            
            // Show thank you section
            showThankYouMessage();
        }

        function showThankYouMessage() {
            // Hide other sections and show thank you
            document.getElementById('thankYouSection').style.display = 'block';
            
            // Add dynamic stats to thank you section
            const statsElement = document.getElementById('thankYouStats');
            const questions = qsfData?.SurveyElements?.filter(e => e.Element === 'SQ')?.length || 0;
            const surveyName = window.currentSurveyName || 'your survey';
            
            statsElement.innerHTML = `
                <h4 style="color: #22c55e; margin-bottom: 12px;">Your Survey Analysis</h4>
                <p style="color: #d1d5db; margin-bottom: 8px;">
                    <strong>${surveyName}</strong> contains <strong>${questions} questions</strong>
                </p>
                <p style="color: #9ca3af; font-size: 14px;">
                    Manual documentation would have taken 2-3 hours. You just did it in 15 minutes!
                </p>
            `;
            
            // Smooth scroll to thank you section
            document.getElementById('thankYouSection').scrollIntoView({ 
                behavior: 'smooth', 
                block: 'center' 
            });
            
            // Track thank you view
            if (typeof dataLayer !== 'undefined') {
                dataLayer.push({
                    'event': 'thank_you_viewed',
                    'survey_questions': questions,
                    'survey_name': window.currentSurveyName
                });
            }
        }

        // Enhanced tracking for user interactions
        document.addEventListener('DOMContentLoaded', function() {
            // Track page load
            if (typeof dataLayer !== 'undefined') {
                dataLayer.push({
                    'event': 'page_view',
                    'page_title': 'QSF to Excel Tool',
                    'page_location': window.location.href
                });
            }
            
            // Track scroll depth
            let maxScroll = 0;
            window.addEventListener('scroll', function() {
                const scrollPercent = Math.round((window.scrollY / (document.body.scrollHeight - window.innerHeight)) * 100);
                if (scrollPercent > maxScroll && scrollPercent % 25 === 0) {
                    maxScroll = scrollPercent;
                    if (typeof dataLayer !== 'undefined') {
                        dataLayer.push({
                            'event': 'scroll_depth',
                            'scroll_percentage': scrollPercent,
                            'page': 'qsf_tool'
                        });
                    }
                }
            });
            
            // Track CTA clicks in thank you section
            document.addEventListener('click', function(e) {
                if (e.target.textContent === 'Learn About Survey Automation') {
                    if (typeof dataLayer !== 'undefined') {
                        dataLayer.push({
                            'event': 'cta_click',
                            'button_text': 'Learn About Survey Automation',
                            'button_location': 'thank_you_section',
                            'user_type': 'tool_user'
                        });
                    }
                }
                
                if (e.target.textContent === 'üì§ Share Tool') {
                    if (typeof dataLayer !== 'undefined') {
                        dataLayer.push({
                            'event': 'share_click',
                            'share_type': 'linkedin',
                            'content': 'qsf_tool'
                        });
                    }
                }
            });
        });

        // Smooth scrolling for navigation links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // Add floating header effect
        window.addEventListener('scroll', () => {
            const nav = document.querySelector('.nav');
            if (window.scrollY > 100) {
                nav.style.background = 'rgba(17, 24, 39, 0.95)';
                nav.style.boxShadow = '0 4px 6px -1px rgba(0, 0, 0, 0.1)';
            } else {
                nav.style.background = 'rgba(17, 24, 39, 0.5)';
                nav.style.boxShadow = 'none';
            }
        });
    </script>
</body>
</html>
